<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="predictNMB">
<title>predictNMB • predictNMB</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="predictNMB">
<meta property="og:description" content="predictNMB">
<meta property="og:image" content="https://rwparsons.github.io/predictNMB/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">predictNMB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/predictNMB.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/creating-nmb-functions.html">Creating NMB functions</a>
    <a class="dropdown-item" href="../articles/detailed-example.html">Detailed example: pressure injury model</a>
    <a class="dropdown-item" href="../articles/summarising-results-with-predictNMB.html">Summarising results from predictNMB</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rwparsons/predictNMB/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>predictNMB</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rwparsons/predictNMB/blob/HEAD/vignettes/predictNMB.Rmd" class="external-link"><code>vignettes/predictNMB.Rmd</code></a></small>
      <div class="d-none name"><code>predictNMB.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="predictnmb">
<code>{predictNMB}</code><a class="anchor" aria-label="anchor" href="#predictnmb"></a>
</h2>
<p><a href="https://rwparsons.github.io/predictNMB/">predictNMB</a> can be used to evaluate existing or
hypothetical clinical prediction models based on their Net Monetary
Benefit (NMB). This can be relevant to both prognostic and diagnostic
models where a cutpoint (AKA, probability threshold) is used to generate
predicted classes rather than probabilities. While it is often
beneficial in clinical settings to present the user with a predicted
probability, it may be helpful to simulate the effect of the decision
arising from this probability. For example, in a hospital setting, a
user might want to specify the probability threshold for a clinical
prediction model that predicts inpatient falls at which best practice
suggests providing a fall-prevention intervention over non-treatment as
the default strategy. By weighing the NMB of these decisions, users can
assess the impact of the model and the suggested threshold prior to
implementation.</p>
<p><a href="https://rwparsons.github.io/predictNMB/">predictNMB</a> was born out of related work that
investigates cutpoint selection methods which maximise the NMB, and
includes several options for inbuilt and user-specified cutpoint
selection functions.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rwparsons.github.io/predictNMB/">predictNMB</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="whats-being-simulated">What’s being simulated?<a class="anchor" aria-label="anchor" href="#whats-being-simulated"></a>
</h3>
<p>When <code><a href="../reference/do_nmb_sim.html">do_nmb_sim()</a></code> is run, many datasets are created, and
models are fit and evaluated based on their NMB. To evaluate NMB, the
user is required to specify functions that define each square of the
confusion matrix, which arises from binary classification:</p>
<ul>
<li>TP: True Positives, correctly predicted events that lead to
necessary treatment</li>
<li>TN: True Negatives, correctly predicted non-events that avoid
unnecessary treatment</li>
<li>FP: False Positives, incorrectly predicted positives that lead to
unnecessary treatment</li>
<li>FN: False Negatives, incorrectly predicted non-events that lead to a
lack of necessary treatment</li>
</ul>
<p>These are presented as a function so that we can repeatedly sample
from it to get uncertainty estimates. We might want to sample from a
distribution for uncertain parameters (for example, TP and FN) or use
constants for parameters we are certain of (here, TN and FP). The
function returns a vector representing each square of the matrix when
called.</p>
<div class="section level4">
<h4 id="example-function">Example function<a class="anchor" aria-label="anchor" href="#example-function"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_nmb_sampler</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"TP"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, mean <span class="op">=</span> <span class="op">-</span><span class="fl">80</span>, sd <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>    <span class="st">"TN"</span> <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    <span class="st">"FP"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">20</span>,</span>
<span>    <span class="st">"FN"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, mean <span class="op">=</span> <span class="op">-</span><span class="fl">100</span>, sd <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="../reference/get_nmb_sampler.html">get_nmb_sampler</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;         TP         TN         FP         FN </span></span>
<span><span class="co">#&gt;  -73.14521    0.00000  -20.00000 -105.64698</span></span>
<span><span class="fu"><a href="../reference/get_nmb_sampler.html">get_nmb_sampler</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;        TP        TN        FP        FN </span></span>
<span><span class="co">#&gt; -78.18436   0.00000 -20.00000 -93.67137</span></span>
<span><span class="fu"><a href="../reference/get_nmb_sampler.html">get_nmb_sampler</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;         TP         TN         FP         FN </span></span>
<span><span class="co">#&gt;  -77.97866    0.00000  -20.00000 -101.06125</span></span></code></pre></div>
<p>Every time we run this function, we get a new named vector for the
NMB associated with each prediction. We can inform the distributions
that we sample from based on the literature for the specific clinical
prediction model at hand. See the <a href="https://rwparsons.github.io/predictNMB/articles/detailed-example.html">detailed
example vignette</a> for a more in-depth description of using estimates
from the literature.</p>
<p>In this example function, the value returned for the True Negative
(TN) is zero. This may reflect a scenario where patients categorised as
low risk are not given any treatment and do not experience the event
being predicted (e.g. a fall) so do not have those associated costs
either. The False Negative (FN) is the most negative value; this is
because this reflects the worst possible outcome: the patient
experiences the event and no intervention was provided to reduce its
rate or the effect of its associated costs. The True Positive value is
similar to the FN, but is not as negative, because the patient received
the intervention and this reduced the associated costs, possibly by
reducing the rate of the event. These two classifications have
uncertainty associated with them since the costs associated with the
outcome are uncertain. This is unlike the False Positive (FP), which has
a fixed cost of $20. This may be realistic when there are set costs for
providing the intervention. For example, if the intervention is to
conduct a falls education session with the patient, this may have an
exact, known cost. See the detailed example vignette for further
description and an example of how to decide on which values to use.</p>
<p>Since we would expect to use our best estimates, in this case the
expected value of the NMB associated with each prediction for an actual
model (and not take a random sample from its underlying distributions),
we will make a separate function for the purpose of obtaining the
cutpoint, separately from the one we used (above) to evaluate it.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_nmb_sampler_training</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"TP"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">80</span>,</span>
<span>    <span class="st">"TN"</span> <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    <span class="st">"FP"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">20</span>,</span>
<span>    <span class="st">"FN"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">100</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">get_nmb_sampler_training</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   TP   TN   FP   FN </span></span>
<span><span class="co">#&gt;  -80    0  -20 -100</span></span></code></pre></div>
<p>These inputs can be passed to <code><a href="../reference/screen_simulation_inputs.html">screen_simulation_inputs()</a></code>
under the parameters <code>fx_nmb_training</code> and
<code>fx_nmb_evaluation</code>, to be evaluated in each simulation.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="do_nmb_sim">
<code>do_nmb_sim()</code><a class="anchor" aria-label="anchor" href="#do_nmb_sim"></a>
</h2>
<p><code><a href="../reference/do_nmb_sim.html">do_nmb_sim()</a></code> does a single simulation with a set of
inputs for the hypothetical model and NMB related functions. For the
model, we need to know the sample size for training and evaluation sets,
the model’s discrimination (Area Under the Receiver Operating
Characteristic Curve, also known as the Area Under the Curve, or AUC)
and the event rate of the outcome being predicted. To create this model,
the specified AUC is transformed to a Cohen’s D value <span class="citation">(<a href="#ref-SalgadoJes%C3%BAsF.2018Ttau" role="doc-biblioref">Salgado 2018</a>)</span>. A single predictor
variable for the negative events are sampled from a standard normal
distribution (mean = 0; standard deviation = 1) and the positive events
have theirs sampled from a normal distribution with a mean equal to the
calculated Cohen’s D value and standard deviation of 1. These data are
then used to fit a logistic regression model with the single predictor
and intercept term.</p>
<p>Note that it may take some time to run the simulation. (The one below
may take up to a minute, depending on your computer’s performance.)</p>
<p>We have used <code>show_progress = TRUE</code> so that this progress
is displayed but by default this progress bar is not shown.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nmb_simulation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/do_nmb_sim.html">do_nmb_sim</a></span><span class="op">(</span></span>
<span>  sample_size <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  n_sims <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  n_valid <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  sim_auc <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  event_rate <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  fx_nmb_training <span class="op">=</span> <span class="va">get_nmb_sampler_training</span>,</span>
<span>  fx_nmb_evaluation <span class="op">=</span> <span class="va">get_nmb_sampler</span>,</span>
<span>  show_progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">nmb_simulation</span></span>
<span><span class="co">#&gt; predictNMB object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Training data sample size:  1000</span></span>
<span><span class="co">#&gt; Minimum number of events in training sample:  100</span></span>
<span><span class="co">#&gt; Evaluation data sample size:  10000</span></span>
<span><span class="co">#&gt; Number of simulations:  500</span></span>
<span><span class="co">#&gt; Simulated AUC:  0.7</span></span>
<span><span class="co">#&gt; Simulated event rate:  0.1</span></span></code></pre></div>
<p>We can access simulation outputs like NMB and cutpoints directly from
our simulation object, and choose strategies to examine further using
this list. This is useful to examine histograms or get summary values.
For example, our current default strategy might be to treat all, which
is the same as setting our probability threshold for treatment to 0:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span></span>
<span>  <span class="va">nmb_simulation</span><span class="op">$</span><span class="va">df_result</span><span class="op">$</span><span class="va">all</span>, </span>
<span>  main <span class="op">=</span> <span class="st">"Simulation results - treat all"</span>, </span>
<span>  xlab <span class="op">=</span> <span class="st">"Net monetary benefit (NMB)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="predictNMB_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">nmb_simulation</span><span class="op">$</span><span class="va">df_result</span><span class="op">$</span><span class="va">all</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;  -27.87  -26.39  -25.99  -26.02  -25.66  -24.41</span></span></code></pre></div>
<p>The simulation under the various cutpoints can be visualised using
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>. The default is to visualise the distributions of
NMB across all (500) simulations. In the plot below, the spread (light
blue) shows the variability in results due to repeated simulation. The
median is represented with the dark blue line in the centre of each
distribution.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nmb_simulation</span><span class="op">)</span></span></code></pre></div>
<p><img src="predictNMB_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<p>Treating all looks like a bad option here. The rest are relatively
similar at this AUC and event rate, with an edge to treat none or the
models using either the value optimisation or cost minimisation cutpoint
method.</p>
<p>We have options to include multiple cutpoint methods, and the default
is to use all of the available inbuilt methods as well as the treat-all
and treat-none strategies. We can specify which methods are shown in the
plots when creating the plot. (For more details on plotting, see the <a href="https://rwparsons.github.io/predictNMB/articles/summarising-results-with-predictNMB.html">summarising
results vignettes</a>.)</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_inbuilt_cutpoint.html">get_inbuilt_cutpoint</a></span><span class="op">(</span>return_all_methods <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "all"              "none"             "value_optimising" "youden"          </span></span>
<span><span class="co">#&gt; [5] "cost_minimising"  "prod_sens_spec"   "roc01"            "index_of_union"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nmb_simulation</span>, methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="st">"none"</span>, <span class="st">"youden"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="predictNMB_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>We can also use this same plotting function to visualise cutpoints or
the incremental net monetary benefit (INB) if we have a known reference
strategy, in this case treat-all:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nmb_simulation</span>, what <span class="op">=</span> <span class="st">"cutpoints"</span><span class="op">)</span></span></code></pre></div>
<p><img src="predictNMB_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nmb_simulation</span>, what <span class="op">=</span> <span class="st">"inb"</span>, inb_ref_col <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
<p><img src="predictNMB_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<p>Compared with treat-all, every alternative looks better, but treating
none or using value-optimising/cost-minimising look the best.</p>
<p>We can compare the NMB for each cutpoint method, as before, by
accessing the object directly:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nmb_simulation</span><span class="op">$</span><span class="va">df_result</span><span class="op">)</span></span>
<span><span class="co">#&gt;   n_sim       all       none value_optimising    youden cost_minimising</span></span>
<span><span class="co">#&gt; 1     1 -25.08691  -9.791819        -9.791819 -14.56210       -9.790418</span></span>
<span><span class="co">#&gt; 2     2 -25.16047 -10.404846       -10.432962 -14.84745      -10.398127</span></span>
<span><span class="co">#&gt; 3     3 -25.37430  -7.751921        -7.863095 -11.30976       -7.760092</span></span>
<span><span class="co">#&gt; 4     4 -27.12287 -10.936631       -10.933125 -15.15321      -10.931125</span></span>
<span><span class="co">#&gt; 5     5 -26.13946  -9.476418        -9.475121 -15.19484       -9.476418</span></span>
<span><span class="co">#&gt; 6     6 -26.12984 -12.631143       -12.586456 -19.13756      -12.621600</span></span>
<span><span class="co">#&gt;   prod_sens_spec     roc01 index_of_union</span></span>
<span><span class="co">#&gt; 1      -14.56210 -13.49478      -13.49478</span></span>
<span><span class="co">#&gt; 2      -14.84745 -14.84745      -14.84745</span></span>
<span><span class="co">#&gt; 3      -11.30976 -13.65652      -13.65652</span></span>
<span><span class="co">#&gt; 4      -15.15321 -15.15321      -15.15321</span></span>
<span><span class="co">#&gt; 5      -15.19484 -15.19484      -15.19484</span></span>
<span><span class="co">#&gt; 6      -16.29397 -16.29397      -16.13769</span></span></code></pre></div>
<p>… and do the same for our selected cutpoints:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nmb_simulation</span><span class="op">$</span><span class="va">df_thresholds</span><span class="op">)</span></span>
<span><span class="co">#&gt;   n_sim all none value_optimising     youden cost_minimising prod_sens_spec</span></span>
<span><span class="co">#&gt; 1     1   0    1        1.0000000 0.09641938             0.5     0.09641938</span></span>
<span><span class="co">#&gt; 2     2   0    1        0.3627289 0.10026226             0.5     0.10026226</span></span>
<span><span class="co">#&gt; 3     3   0    1        0.3579602 0.13212194             0.5     0.13212194</span></span>
<span><span class="co">#&gt; 4     4   0    1        0.4854135 0.09627723             0.5     0.09627723</span></span>
<span><span class="co">#&gt; 5     5   0    1        0.3615890 0.11192980             0.5     0.11192980</span></span>
<span><span class="co">#&gt; 6     6   0    1        0.4265252 0.07235760             0.5     0.09989894</span></span>
<span><span class="co">#&gt;        roc01 index_of_union</span></span>
<span><span class="co">#&gt; 1 0.11099649     0.11099649</span></span>
<span><span class="co">#&gt; 2 0.10026226     0.10026226</span></span>
<span><span class="co">#&gt; 3 0.09857486     0.09857486</span></span>
<span><span class="co">#&gt; 4 0.09627723     0.09627723</span></span>
<span><span class="co">#&gt; 5 0.11192980     0.11192980</span></span>
<span><span class="co">#&gt; 6 0.09989894     0.10231104</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="screen_simulation_inputs">
<code>screen_simulation_inputs()</code><a class="anchor" aria-label="anchor" href="#screen_simulation_inputs"></a>
</h2>
<p>We may want to investigate what the relative improvement in NMB is
when increasing the model performance (AUC) and compare this to the
treat all or treat none strategy. The following function assesses the
required performance for the model to outperform a default strategy of
treat all or treat none. In this example, cutpoints are selected using
the Youden index and the cost-effectiveness approach, which maximises
NMB.</p>
<p>To do this, we compare multiple simulations with different inputs
using <code><a href="../reference/screen_simulation_inputs.html">screen_simulation_inputs()</a></code>. This function takes the
same inputs as <code><a href="../reference/do_nmb_sim.html">do_nmb_sim()</a></code> but can take a vector of inputs
rather than only a single value. Here, we pass vectors for both the
<code>sim_auc</code> and the <code>event_rate</code>.</p>
<p>We run the simulations in parallel by creating a cluster and passing
this as an argument. This can also be done to <code><a href="../reference/do_nmb_sim.html">do_nmb_sim()</a></code>
in the same way. This can take some time — the fewer cores used, the
longer it takes. For more details on running in parallel, see the
<code>parallel</code> package.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_screen_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/screen_simulation_inputs.html">screen_simulation_inputs</a></span><span class="op">(</span></span>
<span>  n_sims <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  n_valid <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  sim_auc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.95</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  event_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>  fx_nmb_training <span class="op">=</span> <span class="va">get_nmb_sampler_training</span>,</span>
<span>  fx_nmb_evaluation <span class="op">=</span> <span class="va">get_nmb_sampler</span>,</span>
<span>  cutpoint_methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="st">"none"</span>, <span class="st">"youden"</span>, <span class="st">"value_optimising"</span><span class="op">)</span>,</span>
<span>  cl <span class="op">=</span> <span class="va">cl</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span></code></pre></div>
<p>For our hypothetical costed outcome, the classification model when
the cutpoint is selected by maximising the Youden index, only
out-performs the treat-none strategy when the model has a AUC of about
0.9. This is quite high, and may be impossible when the outcome is
highly unpredictable. Also, when the event rate is 0.1, rather than 0.2,
we are only able the match the treat-none strategy when our model has an
AUC of 0.95.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_screen_obj</span>, x_axis_var <span class="op">=</span> <span class="st">"sim_auc"</span>, constants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>event_rate <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Varying simulation inputs, other than sim_auc, are being held constant:</span></span>
<span><span class="co">#&gt; event_rate: 0.2</span></span></code></pre></div>
<p><img src="predictNMB_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_screen_obj</span>, x_axis_var <span class="op">=</span> <span class="st">"sim_auc"</span>, constants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>event_rate <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Varying simulation inputs, other than sim_auc, are being held constant:</span></span>
<span><span class="co">#&gt; event_rate: 0.1</span></span></code></pre></div>
<p><img src="predictNMB_files/figure-html/unnamed-chunk-15-2.png" width="672"></p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-SalgadoJesúsF.2018Ttau" class="csl-entry">
Salgado, Jesús F. 2018. <span>“Transforming the Area Under the Normal
Curve (AUC) into Cohen’s d, Pearson’s Rpb, Odds-Ratio, and Natural Log
Odds-Ratio: Two Conversion Tables.”</span> <em>The European Journal of
Psychology Applied to Legal Context</em> 10 (1): 35–47.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Rex Parsons, Robin Blythe, Adrian Barnett.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
