<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="predictNMB">
<title>Detailed example: pressure injury model • predictNMB</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Detailed example: pressure injury model">
<meta property="og:description" content="predictNMB">
<meta property="og:image" content="https://rwparsons.github.io/predictNMB/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">predictNMB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/predictNMB.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/creating-nmb-functions.html">Creating NMB functions</a>
    <a class="dropdown-item" href="../articles/detailed-example.html">Detailed example: pressure injury model</a>
    <a class="dropdown-item" href="../articles/summarising-results-with-predictNMB.html">Summarising results from predictNMB</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rwparsons/predictNMB/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Detailed example: pressure injury model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rwparsons/predictNMB/blob/HEAD/vignettes/detailed-example.Rmd" class="external-link"><code>vignettes/detailed-example.Rmd</code></a></small>
      <div class="d-none name"><code>detailed-example.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rwparsons.github.io/predictNMB/">predictNMB</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="detailed-example">Detailed example<a class="anchor" aria-label="anchor" href="#detailed-example"></a>
</h2>
<p>Economic analyses often combine information from a variety of
sources, including randomised controlled trials, costing studies, and
local data. An advantage of simulation is that it can estimate the
utility of a proposed intervention prior to implementation.</p>
<p>In this example, we simulate the decision process for an analyst at a
hospital with a high rate of pressure injuries (or bedsores), also known
as pressure ulcers. Pressure ulcers are considered significant adverse
events for patients, often leading to additional discomfort, prolonged
length of hospital stay, and increased costs. The hospital currently
uses pressure ulcer prevention interventions routinely, but our analyst
is examining whether to implement a new clinical prediction model to
identify patients who may not benefit from existing interventions and
provide decision support to reduce non-beneficial care.</p>
<p>Let’s begin by generating some realistic costs and probabilities.
Keep in mind, we are trying to avoid a negative event, so the net
monetary benefit of every strategy in this scenario is going to be
negative. In this case, negative values will represent costs, we aim to
maximise these values (reduce costs). If we were also interested in
improving quality of life, we could estimate quality-adjusted life years
(QALYs), multiply them by a willingness-to-pay threshold (WTP), and add
this gain or loss to our true positive and false negative estimates to
signify the impact on the patient. For simplicity, let’s say we’re only
interested in hospital costs.</p>
<p>Model inputs:</p>
<ul>
<li>Mean incremental cost per pressure injury: $9,324 (SE 814), adapted
from a study of Australian public hospitals and updated to 2021 AUD
<span class="citation">(<a href="#ref-nguyen2015pressure" role="doc-biblioref">Nguyen, Chaboyer, and Whitty 2015</a>)</span>
</li>
<li>Per-patient cost of pressure ulcer prevention intervention (PUP):
$161 (SE 49), taken from a 2017 study and updated to 2021 AUD <span class="citation">(<a href="#ref-WHITTY201735" role="doc-biblioref">Whitty et al. 2017</a>)</span>
</li>
<li>Hazard ratio of pressure ulcer with intervention compared to
non-intervention: 0.58 (log hazard ratio SE 0.43) <span class="citation">(<a href="#ref-chaboyer2016effect" role="doc-biblioref">Chaboyer et al. 2016</a>)</span>
</li>
<li>AUC: 0.82 <span class="citation">(<a href="#ref-cichosz2019prediction" role="doc-biblioref">Cichosz et al.
2019</a>)</span>
</li>
<li>Hypothetical hospital pressure injury incidence/event rate: 0.1 (SE
0.02)</li>
</ul>
<p>With these inputs, we can populate our confusion matrix (2 <span class="math inline">\(\times\)</span> 2 table), which helps us
understand the outcomes resulting from correct and incorrect
predictions.</p>
<div class="section level3">
<h3 id="model-inputs">Model inputs<a class="anchor" aria-label="anchor" href="#model-inputs"></a>
</h3>
<p>First, we need to define our NMB function, which provides data for
our simulation. In this case, the intervention is associated with a
hazard ratio of 0.58 for pressure ulcer under intervention conditions
compared to standard care. We can use a probability-weighted cost saving
for successful prevention, at $9324*(0.58) = an improvement of around
$5048. After including $161 in intervention costs, the net benefit is
around $4888 for a successfully prevented pressure ulcer.</p>
<p>The AUC is 0.82, which represents the proportion of random positive
patients that received a higher probability of an injury than random
negative patients (and vice versa). A useful property of the AUC is that
it is the same no matter what probability threshold we use. In our case,
an AUC of 0.82 means that the model will assign higher probabilities of
a pressure ulcer to around 82% of patients who go on to develop an ulcer
compared to patients that don’t.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">fx_nmb</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">cost_of_pi</span> <span class="op">&lt;-</span> <span class="fl">9324</span></span>
<span>  <span class="va">eff_pup</span> <span class="op">&lt;-</span> <span class="fl">0.58</span></span>
<span>  <span class="va">cost_pup</span> <span class="op">&lt;-</span> <span class="fl">161</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="co"># True positive = Correctly predicted event savings - intervention cost</span></span>
<span>    <span class="st">"TP"</span> <span class="op">=</span> <span class="op">-</span><span class="va">cost_of_pi</span> <span class="op">*</span> <span class="va">eff_pup</span> <span class="op">-</span> <span class="va">cost_pup</span>, </span>
<span>    </span>
<span>    <span class="co"># False positive: Cost of (unnecessary) treatment from incorrectly </span></span>
<span>    <span class="co"># predicted positive</span></span>
<span>    <span class="st">"FP"</span> <span class="op">=</span> <span class="op">-</span><span class="va">cost_pup</span>, </span>
<span>    </span>
<span>    <span class="co"># True negative: No cost of treatment or event from correctly </span></span>
<span>    <span class="co"># predicted negative</span></span>
<span>    <span class="st">"TN"</span> <span class="op">=</span> <span class="fl">0</span>, </span>
<span>    </span>
<span>    <span class="co"># False negative: Full cost of event from incorrectly predicted negative</span></span>
<span>    <span class="st">"FN"</span> <span class="op">=</span> <span class="op">-</span><span class="va">cost_of_pi</span> </span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">fx_nmb</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;       TP       FP       TN       FN </span></span>
<span><span class="co">#&gt; -5568.92  -161.00     0.00 -9324.00</span></span></code></pre></div>
<p>For a first pass, we want to see how our current values affect the
estimated NMB from model implementation. We will just use our best
guesses for now, but for a rigorous simulation, we will want to use
Monte Carlo methods to sample from input distributions.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nmb_simulation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/do_nmb_sim.html">do_nmb_sim</a></span><span class="op">(</span></span>
<span>  <span class="co"># Evaluating a theoretical cohort of 1,000 patients</span></span>
<span>  sample_size <span class="op">=</span> <span class="fl">1000</span>, </span>
<span>  </span>
<span>  <span class="co"># The larger the number of simulations, the longer it takes to run, but the </span></span>
<span>  <span class="co"># more reliable the results</span></span>
<span>  n_sims <span class="op">=</span> <span class="fl">500</span>, </span>
<span>  </span>
<span>  <span class="co"># Number of times the NMB is evaluated under each cutpoint</span></span>
<span>  n_valid <span class="op">=</span> <span class="fl">10000</span>, </span>
<span>  </span>
<span>  <span class="co"># The AUC of our proposed model</span></span>
<span>  sim_auc <span class="op">=</span> <span class="fl">0.82</span>,</span>
<span>  </span>
<span>  <span class="co"># The incidence of pressure ulcers at our hypothetical hospital</span></span>
<span>  event_rate <span class="op">=</span> <span class="fl">0.1</span>, </span>
<span>  </span>
<span>  <span class="co"># As a first pass, we will just use our confusion matrix vector above for </span></span>
<span>  <span class="co"># training and evaluation</span></span>
<span>  fx_nmb_training <span class="op">=</span> <span class="va">fx_nmb</span>, </span>
<span>  fx_nmb_evaluation <span class="op">=</span> <span class="va">fx_nmb</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">nmb_simulation</span></span>
<span><span class="co">#&gt; predictNMB object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Training data sample size:  1000</span></span>
<span><span class="co">#&gt; Minimum number of events in training sample:  100</span></span>
<span><span class="co">#&gt; Evaluation data sample size:  10000</span></span>
<span><span class="co">#&gt; Number of simulations:  500</span></span>
<span><span class="co">#&gt; Simulated AUC:  0.82</span></span>
<span><span class="co">#&gt; Simulated event rate:  0.1</span></span>
<span></span>
<span><span class="co"># Get the median incremental NMB for each threshold selection method</span></span>
<span><span class="fu"><a href="../reference/make_summary_table.html">make_summary_table</a></span><span class="op">(</span><span class="va">nmb_simulation</span><span class="op">)</span> </span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 3</span></span></span>
<span><span class="co">#&gt;   method           median `95% CI`        </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> all               -<span style="color: #BB0000;">702.</span> -736.2 to -670.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> cost minimising   -<span style="color: #BB0000;">666.</span> -702.2 to -631.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> index of union    -<span style="color: #BB0000;">693.</span> -739.2 to -651.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> none              -<span style="color: #BB0000;">933.</span> -991.7 to -877.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> prod sens spec    -<span style="color: #BB0000;">693.</span> -741.4 to -651.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> roc01             -<span style="color: #BB0000;">693.</span> -737.9 to -654.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> value optimising  -<span style="color: #BB0000;">668.</span> -708.1 to -632.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> youden            -<span style="color: #BB0000;">694.</span> -746.5 to -647.2</span></span>
<span></span>
<span><span class="co"># Demonstrates the range of selected cutpoints under each method</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nmb_simulation</span>, what <span class="op">=</span> <span class="st">"cutpoints"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="detailed-example_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compares the incremental benefit of each alternate strategy to our </span></span>
<span><span class="co"># current practice (treat all)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nmb_simulation</span>, what <span class="op">=</span> <span class="st">"inb"</span>, inb_ref_col <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="detailed-example_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<p>Our first pass shows treating none is likely to be an undesirable
option, outperformed by every other method. If we set treat none as the
reference strategy, it would have an NMB of $0. Treat all looks like a
pretty good choice, so we could consider making the intervention
standard practice. The best option from a NMB perspective looks to be
our value optimising or the cost minimising method. The first plot shows
that this is actually a lower threshold than the Youden index and other
equivalents, which means that we can be a bit less strict in deciding
who gets the intervention. So our intervention might be worth using even
for some low risk patients.</p>
<p>Results from the ROC-based methods like the Youden index and index of
union are also quite uncertain, so we may not want to use them for these
input parameters. However, the utility of these models and the threshold
selection methods based on the ROC might improve as they get more
accurate, or as the event rate increases; what we really want to know is
how robust our results are to changes in the input parameters. This is
the purpose of <code><a href="../reference/screen_simulation_inputs.html">screen_simulation_inputs()</a></code>. We can not only
simulate from a distribution for our cost inputs, we can pass a vector
to the AUC and incidence arguments to understand how these impact our
findings.</p>
<p>First, let’s specify our sampler function for the confusion matrix.
We can replace our inputs with single samples from distributions. Make
sure use code within the function to generate the samples so that they
are resampled every simulation. This propagates the uncertainty of these
distributions into the NMB values in the many simulations that we
run.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fx_nmb_sampler</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">cost_of_pi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">9234</span>, sd <span class="op">=</span> <span class="fl">814</span><span class="op">)</span></span>
<span>  <span class="va">eff_pup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.58</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.43</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">cost_pup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">161</span>, sd <span class="op">=</span> <span class="fl">49</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"TP"</span> <span class="op">=</span> <span class="op">-</span><span class="va">cost_of_pi</span> <span class="op">*</span> <span class="va">eff_pup</span> <span class="op">-</span> <span class="va">cost_pup</span>,</span>
<span>    <span class="st">"FP"</span> <span class="op">=</span> <span class="op">-</span><span class="va">cost_pup</span>,</span>
<span>    <span class="st">"TN"</span> <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    <span class="st">"FN"</span> <span class="op">=</span> <span class="op">-</span><span class="va">cost_of_pi</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">fx_nmb_sampler</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;         TP         FP         TN         FN </span></span>
<span><span class="co">#&gt; -4172.1138  -253.2204     0.0000 -9176.1184</span></span>
<span><span class="fu">fx_nmb_sampler</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;         TP         FP         TN         FN </span></span>
<span><span class="co">#&gt; -6124.6967  -121.8554     0.0000 -8990.9976</span></span>
<span><span class="fu">fx_nmb_sampler</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;         TP         FP         TN         FN </span></span>
<span><span class="co">#&gt; -3815.4057  -169.2083     0.0000 -8135.4876</span></span></code></pre></div>
<p>The sampler function shows that we can expect some significant
variation, especially due to the probability that our intervention is
effective. It’s always possible that an intervention could lead to worse
patient outcomes. In our case, some true positives could actually be
worse than false negatives!</p>
<p>We should also check whether changing the other inputs can lead to
different results. Perhaps the authors of the clinical prediction model
reported a misleading AUC and when we implement the model it turns out
to be lower, or perhaps our pressure ulcer rate in some wards is
actually quite different to the average incidence at the hospital. By
replacing our <code>sim_auc</code> and <code>event_rate</code> arguments
with vectors, we can run simulations for each possible combination we
are interested in.</p>
<p>In the snippet below, we will compare the treat all strategy to total
disinvestment from the intervention (“none”) and to a couple of
alternative, model-guided strategies, using the “value_optimising” and
“youden” thresholds.</p>
<p>We can also do this in parallel to speed things up.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">sim_pup_screen</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/screen_simulation_inputs.html">screen_simulation_inputs</a></span><span class="op">(</span></span>
<span>  n_sims <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  n_valid <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  sim_auc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.72</span>, <span class="fl">0.92</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  event_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.15</span><span class="op">)</span>,</span>
<span>  cutpoint_methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="st">"none"</span>, <span class="st">"value_optimising"</span>, <span class="st">"youden"</span><span class="op">)</span>,</span>
<span>  fx_nmb_training <span class="op">=</span> <span class="va">fx_nmb</span>,</span>
<span>  fx_nmb_evaluation <span class="op">=</span> <span class="va">fx_nmb_sampler</span>,</span>
<span>  cl <span class="op">=</span> <span class="va">cl</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/make_summary_table.html">make_summary_table</a></span><span class="op">(</span><span class="va">sim_pup_screen</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15 × 10</span></span></span>
<span><span class="co">#&gt;    sim_auc event_rate all_median all_9…¹ none_…² none_…³ value…⁴ value…⁵ youde…⁶</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>    0.72       0.05      -<span style="color: #BB0000;">428.</span> -754.6…   -<span style="color: #BB0000;">461.</span> -545.2…   -<span style="color: #BB0000;">394.</span> -634.1…   -<span style="color: #BB0000;">398.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>    0.72       0.1       -<span style="color: #BB0000;">701.</span> -1478.…   -<span style="color: #BB0000;">920.</span> -1094.…   -<span style="color: #BB0000;">704.</span> -1422.…   -<span style="color: #BB0000;">745.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>    0.72       0.15      -<span style="color: #BB0000;">986.</span> -2070.…  -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">390.</span> -1648.…   -<span style="color: #BB0000;">988.</span> -2064.…  -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">091.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>    0.77       0.05      -<span style="color: #BB0000;">444.</span> -790.2…   -<span style="color: #BB0000;">460.</span> -547.2…   -<span style="color: #BB0000;">397.</span> -641.6…   -<span style="color: #BB0000;">399.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>    0.77       0.1       -<span style="color: #BB0000;">681.</span> -1417.…   -<span style="color: #BB0000;">924.</span> -1086.…   -<span style="color: #BB0000;">675.</span> -1313.…   -<span style="color: #BB0000;">727.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>    0.77       0.15      -<span style="color: #BB0000;">944.</span> -1976.…  -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">377.</span> -1637.…   -<span style="color: #BB0000;">943.</span> -1914.…  -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">048.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>    0.82       0.05      -<span style="color: #BB0000;">424.</span> -778.2…   -<span style="color: #BB0000;">461.</span> -551.4…   -<span style="color: #BB0000;">371.</span> -637.7…   -<span style="color: #BB0000;">370.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>    0.82       0.1       -<span style="color: #BB0000;">704.</span> -1451.…   -<span style="color: #BB0000;">927.</span> -1116.…   -<span style="color: #BB0000;">673.</span> -1366.…   -<span style="color: #BB0000;">711.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>    0.82       0.15      -<span style="color: #BB0000;">967.</span> -2003.…  -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">375.</span> -1677.…   -<span style="color: #BB0000;">957.</span> -1921.…  -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">024.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    0.87       0.05      -<span style="color: #BB0000;">452.</span> -829 t…   -<span style="color: #BB0000;">463.</span> -543.5…   -<span style="color: #BB0000;">375.</span> -659.8…   -<span style="color: #BB0000;">373.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>    0.87       0.1       -<span style="color: #BB0000;">717.</span> -1428 …   -<span style="color: #BB0000;">930.</span> -1087.…   -<span style="color: #BB0000;">678.</span> -1333.…   -<span style="color: #BB0000;">700.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>    0.87       0.15      -<span style="color: #BB0000;">974.</span> -2018.…  -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">388.</span> -1636.…   -<span style="color: #BB0000;">934.</span> -1891.…   -<span style="color: #BB0000;">990.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>    0.92       0.05      -<span style="color: #BB0000;">427.</span> -742.4…   -<span style="color: #BB0000;">456.</span> -543.7…   -<span style="color: #BB0000;">344.</span> -597.1…   -<span style="color: #BB0000;">345.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>    0.92       0.1       -<span style="color: #BB0000;">712.</span> -1450.…   -<span style="color: #BB0000;">922.</span> -1094.…   -<span style="color: #BB0000;">646.</span> -1324.…   -<span style="color: #BB0000;">662.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>    0.92       0.15      -<span style="color: #BB0000;">938.</span> -2254.…  -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">384.</span> -1621.…   -<span style="color: #BB0000;">899.</span> -2141.…   -<span style="color: #BB0000;">932.</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 1 more variable: `youden_95% CI` &lt;chr&gt;, and abbreviated variable names</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ¹​`all_95% CI`, ²​none_median, ³​`none_95% CI`, ⁴​`value optimising_median`,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ⁵​`value optimising_95% CI`, ⁶​youden_median</span></span></span></code></pre></div>
<p>As our model accuracy increases and event rate decreases, treatment
decisions based on the model, like the Youden index, begin to look
better. There are reasonable gains from using the prediction model, even
though there is some uncertainty. If the event rates 0.05, 0.10 and 0.15
corresponded to different wards of the hospital, our simulation could
represent the estimated effectiveness of different strategies in each
setting.</p>
<p>We can also represent these results visually.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">sim_pup_screen</span>, </span>
<span>  x_axis_var <span class="op">=</span> <span class="st">"sim_auc"</span>,</span>
<span>  constants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>event_rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>, </span>
<span>  dodge_width <span class="op">=</span> <span class="fl">0.01</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Varying simulation inputs, other than sim_auc, are being held constant:</span></span>
<span><span class="co">#&gt; event_rate: 0.05</span></span></code></pre></div>
<p><img src="detailed-example_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">sim_pup_screen</span>, </span>
<span>  x_axis_var <span class="op">=</span> <span class="st">"sim_auc"</span>,</span>
<span>  constants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>event_rate <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span>,</span>
<span>  dodge_width <span class="op">=</span> <span class="fl">0.01</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Varying simulation inputs, other than sim_auc, are being held constant:</span></span>
<span><span class="co">#&gt; event_rate: 0.1</span></span></code></pre></div>
<p><img src="detailed-example_files/figure-html/unnamed-chunk-7-2.png" width="672"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">sim_pup_screen</span>, </span>
<span>  x_axis_var <span class="op">=</span> <span class="st">"sim_auc"</span>,</span>
<span>  constants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>event_rate <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span>,</span>
<span>  dodge_width <span class="op">=</span> <span class="fl">0.01</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Varying simulation inputs, other than sim_auc, are being held constant:</span></span>
<span><span class="co">#&gt; event_rate: 0.15</span></span></code></pre></div>
<p><img src="detailed-example_files/figure-html/unnamed-chunk-7-3.png" width="672"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">sim_pup_screen</span>, </span>
<span>  x_axis_var <span class="op">=</span> <span class="st">"event_rate"</span>, </span>
<span>  dodge_width <span class="op">=</span> <span class="fl">0.0075</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Varying simulation inputs, other than event_rate, are being held constant:</span></span>
<span><span class="co">#&gt; sim_auc: 0.72</span></span></code></pre></div>
<p><img src="detailed-example_files/figure-html/unnamed-chunk-7-4.png" width="672"></p>
<p>The nice thing about our cost-effectiveness function is that it tends
to follow the best threshold, regardless of AUC or event rate. In this
case, it tends to dynamically follow the best treatment decision as it
moves across, which is why the value optimising strategy tends to
overlap with the best alternative in the plots. We can also see that the
Youden index begins to look better at higher accuracy and higher
incidence rates, but predicting what patients will get a pressure ulcer
is challenging.</p>
<p>Ultimately at our given AUC and event rate, the prediction model
might be worth using. In the original study, Whitty and colleagues found
that the prevention program was not cost-effective; however, by
combining it with a prediction model, it could be worth implementing,
especially in wards where the event might be rarer. <span class="citation">(<a href="#ref-WHITTY201735" role="doc-biblioref">Whitty et al. 2017</a>)</span>.</p>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-chaboyer2016effect" class="csl-entry">
Chaboyer, Wendy, Tracey Bucknall, Joan Webster, Elizabeth McInnes,
Brigid M Gillespie, Merrilyn Banks, Jennifer A Whitty, et al. 2016.
<span>“The Effect of a Patient Centred Care Bundle Intervention on
Pressure Ulcer Incidence (INTACT): A Cluster Randomised Trial.”</span>
<em>International Journal of Nursing Studies</em> 64: 63–71.
</div>
<div id="ref-cichosz2019prediction" class="csl-entry">
Cichosz, Simon Lebech, Anne-Birgitte Voelsang, Lise Tarnow, John Michael
Hasenkam, and Jesper Fleischer. 2019. <span>“Prediction of in-Hospital
Pressure Ulcer Development.”</span> <em>Advances in Wound Care</em> 8
(1): 1–6.
</div>
<div id="ref-nguyen2015pressure" class="csl-entry">
Nguyen, Kim-Huong, Wendy Chaboyer, and Jennifer A Whitty. 2015.
<span>“Pressure Injury in Australian Public Hospitals: A Cost-of-Illness
Study.”</span> <em>Australian Health Review</em> 39 (3): 329–36.
</div>
<div id="ref-WHITTY201735" class="csl-entry">
Whitty, Jennifer A., Elizabeth McInnes, Tracey Bucknall, Joan Webster,
Brigid M. Gillespie, Merrilyn Banks, Lukman Thalib, et al. 2017.
<span>“The Cost-Effectiveness of a Patient Centred Pressure Ulcer
Prevention Care Bundle: Findings from the INTACT Cluster Randomised
Trial.”</span> <em>International Journal of Nursing Studies</em> 75:
35–42. https://doi.org/<a href="https://doi.org/10.1016/j.ijnurstu.2017.06.014" class="external-link">https://doi.org/10.1016/j.ijnurstu.2017.06.014</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Rex Parsons, Robin Blythe, Adrian Barnett.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
